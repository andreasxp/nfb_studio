<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.8.4" />
<title>nfb_studio.experiment_view API documentation</title>
<meta name="description" content="View widget for Experiment class and the main window of this application." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>nfb_studio.experiment_view</code></h1>
</header>
<section id="section-intro">
<p>View widget for Experiment class and the main window of this application.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;View widget for Experiment class and the main window of this application.&#34;&#34;&#34;
import os
import subprocess
from typing import Optional
from pathlib import Path

from PySide2.QtCore import Qt, QModelIndex
from PySide2.QtGui import QStandardItem, QKeySequence
from PySide2.QtWidgets import QMainWindow, QDockWidget, QStackedWidget, QFileDialog, QMessageBox, QScrollArea

import nfb_studio

from .experiment import Experiment
from .block import BlockView
from .group import GroupView
from .util import StackedDictWidget
from .general_view import GeneralView
from .property_tree import PropertyTree
from .export_wizard import ExportWizard
from .scheme import SchemeEditor
from .signal_nodes import *
from .sequence_nodes import *


class ExperimentView(QMainWindow):
    &#34;&#34;&#34;View widget for Experiment class and the main window of this application.&#34;&#34;&#34;
    def __init__(self, parent=None):
        super().__init__(parent=parent)

        self._model = None
        self._save_path = None
        &#34;&#34;&#34;Save path of the experiment that is being edited.&#34;&#34;&#34;

        # Menu bar -----------------------------------------------------------------------------------------------------
        menubar = self.menuBar()
        filemenu = menubar.addMenu(&#34;File&#34;)

        action_open = filemenu.addAction(&#34;Open&#34;)
        action_open.triggered.connect(self.actionOpen)
        action_open.setShortcut(QKeySequence.Open)

        action_save = filemenu.addAction(&#34;Save&#34;)
        action_save.triggered.connect(self.actionSave)
        action_save.setShortcut(QKeySequence.Save)

        action_save_as = filemenu.addAction(&#34;Save As...&#34;)
        action_save_as.triggered.connect(self.actionSaveAs)
        action_save_as.setShortcut(QKeySequence.SaveAs)

        action_export = filemenu.addAction(&#34;Export...&#34;)
        action_export.triggered.connect(self.actionExport)

        action_import = filemenu.addAction(&#34;Import&#34;)
        action_import.triggered.connect(self.actionImport)

        runmenu = menubar.addMenu(&#34;Run&#34;)

        action_start_ex = runmenu.addAction(&#34;Start Experiment&#34;)
        action_start_ex.triggered.connect(self.actionStartExperiment)
        action_start_ex.setShortcut(&#34;F9&#34;)

        # Property tree ------------------------------------------------------------------------------------------------
        self.tree = PropertyTree()
        self.tree_view = self.tree.getView()
        self.tree_view.currentIndexChanged.connect(self.displayTreeItem)

        # Property tree dock widget ------------------------------------------------------------------------------------
        self.property_tree_dock = QDockWidget(&#34;Properties&#34;, self)
        self.property_tree_dock.setWidget(self.tree_view)
        self.property_tree_dock.setAllowedAreas(Qt.LeftDockWidgetArea | Qt.RightDockWidgetArea)
        self.property_tree_dock.setFeatures(QDockWidget.DockWidgetMovable | QDockWidget.DockWidgetFloatable)
        self.addDockWidget(Qt.LeftDockWidgetArea, self.property_tree_dock)

        # Editing widgets ----------------------------------------------------------------------------------------------
        self.general_view = GeneralView()
        
        self.signal_editor = SchemeEditor()
        self.signal_editor.toolbox().addItem(&#34;LSL Input&#34;, LSLInput())
        self.signal_editor.toolbox().addItem(&#34;Spatial Filter&#34;, SpatialFilter())
        self.signal_editor.toolbox().addItem(&#34;Bandpass Filter&#34;, BandpassFilter())
        self.signal_editor.toolbox().addItem(&#34;Envelope Detector&#34;, EnvelopeDetector())
        self.signal_editor.toolbox().addItem(&#34;Standardise&#34;, Standardise())
        self.signal_editor.toolbox().addItem(&#34;Signal Export&#34;, DerivedSignalExport())
        self.signal_editor.toolbox().addItem(&#34;Composite Signal Export&#34;, CompositeSignalExport())

        self.blocks = StackedDictWidget()
        self.groups = StackedDictWidget()

        # Sequence editor ----------------------------------------------------------------------------------------------
        self.sequence_editor = SchemeEditor()

        # Central widget -----------------------------------------------------------------------------------------------
        self.central_widget = QStackedWidget()
        self.setCentralWidget(self.central_widget)

        scrollarea = QScrollArea()
        scrollarea.setWidget(self.general_view)
        self.central_widget.addWidget(scrollarea)
        self.central_widget.addWidget(self.signal_editor)
        self.central_widget.addWidget(self.blocks)
        self.central_widget.addWidget(self.groups)
        self.central_widget.addWidget(self.sequence_editor)

        # New experiment view is created with a new experiment ---------------------------------------------------------
        self.actionNew()

    # Get/Set methods ==================================================================================================
    def model(self) -&gt; Optional[Experiment]:
        &#34;&#34;&#34;Return the experiment, assosiated with this view.&#34;&#34;&#34;
        return self._model
    
    def projectTitle(self) -&gt; str:
        &#34;&#34;&#34;Return document title, i.e. name of file this experiment is saved as.
        If no file has been associated with this experiment, returns &#34;Untitled&#34;.
        &#34;&#34;&#34;
        if self.savePath():
            return Path(self.savePath()).stem
        return &#34;Untitled&#34;

    def savePath(self) -&gt; Optional[str]:
        &#34;&#34;&#34;Return path of the file from which the &#34;&#34;&#34;
        return self._save_path

    def setModel(self, ex: Experiment, /):
        self._model = ex

        self.tree.setExperiment(ex)
        self.signal_editor.setScheme(ex.signal_scheme)

        self.sequence_editor.setScheme(ex.sequence_scheme)

        ex.blocks.itemAdded.connect(self._onBlockAdded)
        ex.blocks.itemRenamed.connect(self._onBlockRenamed)
        ex.blocks.itemRemoved.connect(self._onBlockRemoved)
        ex.groups.itemAdded.connect(self._onGroupAdded)
        ex.groups.itemRenamed.connect(self._onGroupRenamed)
        ex.groups.itemRemoved.connect(self._onGroupRemoved)

        ex._view = self
        ex.updateView()

    # Experiment syncronization ========================================================================================
    def updateModel(self):
        &#34;&#34;&#34;Update the experiment when data in the view was changed by the user.&#34;&#34;&#34;
        ex = self.model()
        if ex is None:
            return
        
        # For each block, write it&#39;s data to the experiment
        for name in self.blocks.keys():
            block_view: BlockView = self.blocks.widget(name).widget()
            block_view.updateModel()
        
        # For each group, write its data to the experiment
        for name in self.groups.keys():
            group_view: GroupView = self.groups.widget(name).widget()
            group_view.updateModel()

        # Write general experiment data
        self.general_view.updateModel(ex)

    def _onBlockAdded(self, name):
        &#34;&#34;&#34;Function that gets called when a new block has been added to the experiment.&#34;&#34;&#34;
        # Add an item to the property tree
        tree_item = QStandardItem(name)
        tree_item.setFlags(Qt.ItemIsEnabled | Qt.ItemIsSelectable | Qt.ItemIsEditable)
        self.tree.blocks.appendRow(tree_item)
        
        # Add a view to the widget stack
        block_view = BlockView()
        block_view.setModel(self.model().blocks[name])
        scrollarea = QScrollArea()
        scrollarea.setWidget(block_view)
        self.blocks.addWidget(name, scrollarea)

        # Add a node to draw the sequence
        node = BlockNode()
        node.setTitle(name)
        self.sequence_editor.toolbox().addItem(name, node)

        # Select this item
        self.tree_view.setCurrentIndex(self.tree.indexFromItem(tree_item))
    
    def _onGroupAdded(self, name):
        &#34;&#34;&#34;Function that gets called when a new group has been added to the experiment.&#34;&#34;&#34;
        # Add an item to the property tree
        tree_item = QStandardItem(name)
        tree_item.setFlags(Qt.ItemIsEnabled | Qt.ItemIsSelectable | Qt.ItemIsEditable)
        self.tree.groups.appendRow(tree_item)

        # Add a view to the widget stack
        group_view = GroupView()
        group_view.setModel(self.model().groups[name])
        scrollarea = QScrollArea()
        scrollarea.setWidget(group_view)
        self.groups.addWidget(name, scrollarea)

        # Add a node to draw the sequence
        node = GroupNode()
        node.setTitle(name)
        self.sequence_editor.toolbox().addItem(name, node)

        # Select this item
        self.tree_view.setCurrentIndex(self.tree.indexFromItem(tree_item))
    
    def _onBlockRenamed(self, old_name, new_name):
        &#34;&#34;&#34;Function that gets called when a block has been renamed.&#34;&#34;&#34;
        # Rename it in the property tree
        for i in range(self.tree.blocks.rowCount()):
            item = self.tree.blocks.child(i)
            if item.text() == old_name:
                item.setText(new_name)
                break
        
        # Rename in widget stack
        current_key = self.blocks.currentKey()

        w = self.blocks.removeWidget(old_name)
        self.blocks.addWidget(new_name, w)

        if current_key == old_name:
            self.blocks.setCurrentKey(new_name)

        # Rename in the sequence editor
        node = self.sequence_editor.toolbox().removeItem(old_name)
        self.sequence_editor.toolbox().addItem(new_name, node)

        for node in self.sequence_editor.scheme().graph.nodes:
            if node.title() == old_name:
                node.setTitle(new_name)

    def _onGroupRenamed(self, old_name, new_name):
        &#34;&#34;&#34;Function that gets called when a group has been renamed.&#34;&#34;&#34;
        # Rename it in the property tree
        for i in range(self.tree.groups.rowCount()):
            item = self.tree.groups.child(i)
            if item.text() == old_name:
                item.setText(new_name)
                break
        
        # Rename in widget stack
        current_key = self.groups.currentKey()

        w = self.groups.removeWidget(old_name)
        self.groups.addWidget(new_name, w)

        if current_key == old_name:
            self.groups.setCurrentKey(new_name)

        # Rename in the sequence editor
        node = self.sequence_editor.toolbox().removeItem(old_name)
        self.sequence_editor.toolbox().addItem(new_name, node)

        for node in self.sequence_editor.scheme().graph.nodes:
            if node.title() == old_name:
                node.setTitle(new_name)

    def _onBlockRemoved(self, name):
        &#34;&#34;&#34;Function that gets called when a block has been removed from the experiment.&#34;&#34;&#34;
        # Find and remove it from the property tree
        for i in range(self.tree.blocks.rowCount()):
            item = self.tree.blocks.child(i)
            if item.text() == name:
                self.tree.blocks.removeRow(i)
                break
        
        # Remove from widget stack and the sequence editor toolbox
        self.blocks.removeWidget(name)
        self.sequence_editor.toolbox().removeItem(name)
    
    def _onGroupRemoved(self, name):
        &#34;&#34;&#34;Function that gets called when a block has been removed from the experiment.&#34;&#34;&#34;
        # Find and remove it from the property tree        
        for i in range(self.tree.groups.rowCount()):
            item = self.tree.groups.child(i)
            if item.text() == name:
                self.tree.groups.removeRow(i)
                break
        
        # Remove from widget stack and the sequence editor toolbox
        self.groups.removeWidget(name)
        self.sequence_editor.toolbox().removeItem(name)

    # Property tree syncronization =====================================================================================
    def displayTreeItem(self, index: QModelIndex):
        &#34;&#34;&#34;Display the widget corresponding to the item in the property tree.&#34;&#34;&#34;
        item = self.tree.itemFromIndex(index)

        if item is self.tree.general:
            # General
            scrollarea = self.general_view.parent().parent()
            assert type(scrollarea) == QScrollArea
            self.central_widget.setCurrentWidget(scrollarea)
        elif item is self.tree.signals:
            # Signal editor
            self.central_widget.setCurrentWidget(self.signal_editor)
        elif item.parent() is self.tree.blocks:
            # A block
            self.central_widget.setCurrentWidget(self.blocks)
            self.blocks.setCurrentKey(item.text())
        elif item.parent() is self.tree.groups:
            # A group
            self.central_widget.setCurrentWidget(self.groups)
            self.groups.setCurrentKey(item.text())
        elif item is self.tree.sequence:
            # Sequence editor
            self.central_widget.setCurrentWidget(self.sequence_editor)

    # User actions =====================================================================================================
    def actionNew(self) -&gt; bool:
        if self.model() and not self.promptSaveChanges():
            return False  # Action cancelled during prompt

        self.setModel(Experiment())
        self._save_path = None
        self.setWindowTitle(self.projectTitle() + &#34; - NFB Studio&#34;)
        return True

    def actionExport(self) -&gt; bool:        
        self.updateModel()
        
        if (len(self.model().sequence_scheme.graph.nodes) == 0):
            # No nodes in sequence scheme, cancel operation
            # TODO: A better way to signal to the user that he needs to create a sequence?
            self.central_widget.setCurrentWidget(self.sequence_editor)
            return

        wiz = ExportWizard(self, self.model())
        ok = wiz.exec_()
        
        if not ok:
            return  # User cancelled operation

        data = self.model().export(wiz.sequence())
        with open(wiz.savePath(), &#34;w&#34;) as file:
            file.write(data)
        return True

    def actionSave(self) -&gt; bool:
        &#34;&#34;&#34;User action &#34;Save&#34;. Saves file to its location, or promts user if no location exists yet.
        Returns True if file was saved, and False if action was cancelled.
        &#34;&#34;&#34;
        if self.savePath() is None:
            return self.actionSaveAs()
        
        self.fileSave(self.savePath())
        self.setWindowTitle(self.projectTitle() + &#34; - NFB Studio&#34;)
        return True

    def actionSaveAs(self) -&gt; bool:
        &#34;&#34;&#34;User action &#34;Save As&#34;. Promts user to save file as.
        Returns True if file was saved, and False if action was cancelled.
        &#34;&#34;&#34;
        path = QFileDialog.getSaveFileName(filter=&#34;Experiment Files (*.nfbex)&#34;)[0]
        if path == &#34;&#34;:
            return False  # Action was cancelled

        if os.path.splitext(path)[1] == &#34;&#34;:  # No extension
            path = path + &#34;.nfbex&#34;

        self._save_path = path
        self.fileSave(self.savePath())
        self.setWindowTitle(self.projectTitle() + &#34; - NFB Studio&#34;)
        return True

    def actionOpen(self) -&gt; bool:
        &#34;&#34;&#34;User action &#34;Open&#34;. Promts user to open a file.
        Returns True if file was opened, and False if action was cancelled.
        &#34;&#34;&#34;
        if self.model() and not self.promptSaveChanges():
            return False  # Action cancelled during prompt

        path = QFileDialog.getOpenFileName(filter=&#34;Experiment Files (*.nfbex)&#34;)[0]
        if path == &#34;&#34;:
            return False

        self.fileOpen(path)
        self.setWindowTitle(self.projectTitle() + &#34; - NFB Studio&#34;)
        return True

    def actionImport(self) -&gt; bool:
        &#34;&#34;&#34;User action &#34;Import&#34;. Promts user to import a file.
        Returns True if file was imported, and False if action was cancelled.
        &#34;&#34;&#34;
        if self.model() and not self.promptSaveChanges():
            return False  # Action cancelled during prompt

        file_path = QFileDialog.getOpenFileName(filter=&#34;XML Files (*.xml)&#34;)[0]
        if file_path == &#34;&#34;:
            return False

        with open(file_path) as file:
            data = file.read()
        
        ex = Experiment.import_xml(data)
        self.setModel(ex)
        return True

    def actionStartExperiment(self):
        self.updateModel()
        
        if (len(self.model().sequence_scheme.graph.nodes) == 0):
            # No nodes in sequence scheme, cancel operation
            # TODO: A better way to signal to the user that he needs to create a sequence?
            self.central_widget.setCurrentWidget(self.sequence_editor)
            return

        wiz = ExportWizard(self, self.model())
        ok = wiz.exec_()
        
        if not ok:
            return  # User cancelled operation

        data = self.model().export(wiz.sequence())
        with open(wiz.savePath(), &#34;w&#34;) as file:
            file.write(data)
        
        pynfb_path = os.path.dirname(nfb_studio.__file__) + &#34;/bin/pynfb.exe&#34;
        subprocess.run([pynfb_path, &#34;-x&#34;, wiz.savePath()])

    def promptSaveChanges(self) -&gt; bool:
        &#34;&#34;&#34;Prompt the user to save changes to current project.
        Display a message box asking the user if they want to save changes. If user selects Save, execute actionSave.
        Returns True if the user decided to discard changes or saved the file, and False if the user cancelled operation
        either during prompt or during save.
        &#34;&#34;&#34;
        prompt = QMessageBox()
        prompt.setWindowTitle(&#34;NFB Studio&#34;)
        prompt.setIcon(QMessageBox.Warning)
        prompt.setText(&#34;Save changes to \&#34;{}\&#34; before closing?&#34;.format(self.projectTitle()))
        prompt.setStandardButtons(QMessageBox.Save | QMessageBox.Discard | QMessageBox.Cancel)
        prompt.setDefaultButton(QMessageBox.Save)
        
        answer = prompt.exec_()
        if answer == QMessageBox.Cancel:
            return False
        if answer == QMessageBox.Save:
            return self.actionSave()
        return True

    def closeEvent(self, event):
        if self.model():
            event.setAccepted(self.promptSaveChanges())
        else:
            event.accept()

    # File operations ==================================================================================================
    def fileOpen(self, path):
        with open(path) as file:
            data = file.read()
        
        ex = Experiment.load(data)
        self.setModel(ex)
        self._save_path = path

    def fileSave(self, path):
        self.model().view().updateModel()
        data = self.model().save()

        with open(path, &#34;w&#34;) as file:
            file.write(data)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="nfb_studio.experiment_view.ExperimentView"><code class="flex name class">
<span>class <span class="ident">ExperimentView</span></span>
<span>(</span><span>parent=None)</span>
</code></dt>
<dd>
<div class="desc"><p>View widget for Experiment class and the main window of this application.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ExperimentView(QMainWindow):
    &#34;&#34;&#34;View widget for Experiment class and the main window of this application.&#34;&#34;&#34;
    def __init__(self, parent=None):
        super().__init__(parent=parent)

        self._model = None
        self._save_path = None
        &#34;&#34;&#34;Save path of the experiment that is being edited.&#34;&#34;&#34;

        # Menu bar -----------------------------------------------------------------------------------------------------
        menubar = self.menuBar()
        filemenu = menubar.addMenu(&#34;File&#34;)

        action_open = filemenu.addAction(&#34;Open&#34;)
        action_open.triggered.connect(self.actionOpen)
        action_open.setShortcut(QKeySequence.Open)

        action_save = filemenu.addAction(&#34;Save&#34;)
        action_save.triggered.connect(self.actionSave)
        action_save.setShortcut(QKeySequence.Save)

        action_save_as = filemenu.addAction(&#34;Save As...&#34;)
        action_save_as.triggered.connect(self.actionSaveAs)
        action_save_as.setShortcut(QKeySequence.SaveAs)

        action_export = filemenu.addAction(&#34;Export...&#34;)
        action_export.triggered.connect(self.actionExport)

        action_import = filemenu.addAction(&#34;Import&#34;)
        action_import.triggered.connect(self.actionImport)

        runmenu = menubar.addMenu(&#34;Run&#34;)

        action_start_ex = runmenu.addAction(&#34;Start Experiment&#34;)
        action_start_ex.triggered.connect(self.actionStartExperiment)
        action_start_ex.setShortcut(&#34;F9&#34;)

        # Property tree ------------------------------------------------------------------------------------------------
        self.tree = PropertyTree()
        self.tree_view = self.tree.getView()
        self.tree_view.currentIndexChanged.connect(self.displayTreeItem)

        # Property tree dock widget ------------------------------------------------------------------------------------
        self.property_tree_dock = QDockWidget(&#34;Properties&#34;, self)
        self.property_tree_dock.setWidget(self.tree_view)
        self.property_tree_dock.setAllowedAreas(Qt.LeftDockWidgetArea | Qt.RightDockWidgetArea)
        self.property_tree_dock.setFeatures(QDockWidget.DockWidgetMovable | QDockWidget.DockWidgetFloatable)
        self.addDockWidget(Qt.LeftDockWidgetArea, self.property_tree_dock)

        # Editing widgets ----------------------------------------------------------------------------------------------
        self.general_view = GeneralView()
        
        self.signal_editor = SchemeEditor()
        self.signal_editor.toolbox().addItem(&#34;LSL Input&#34;, LSLInput())
        self.signal_editor.toolbox().addItem(&#34;Spatial Filter&#34;, SpatialFilter())
        self.signal_editor.toolbox().addItem(&#34;Bandpass Filter&#34;, BandpassFilter())
        self.signal_editor.toolbox().addItem(&#34;Envelope Detector&#34;, EnvelopeDetector())
        self.signal_editor.toolbox().addItem(&#34;Standardise&#34;, Standardise())
        self.signal_editor.toolbox().addItem(&#34;Signal Export&#34;, DerivedSignalExport())
        self.signal_editor.toolbox().addItem(&#34;Composite Signal Export&#34;, CompositeSignalExport())

        self.blocks = StackedDictWidget()
        self.groups = StackedDictWidget()

        # Sequence editor ----------------------------------------------------------------------------------------------
        self.sequence_editor = SchemeEditor()

        # Central widget -----------------------------------------------------------------------------------------------
        self.central_widget = QStackedWidget()
        self.setCentralWidget(self.central_widget)

        scrollarea = QScrollArea()
        scrollarea.setWidget(self.general_view)
        self.central_widget.addWidget(scrollarea)
        self.central_widget.addWidget(self.signal_editor)
        self.central_widget.addWidget(self.blocks)
        self.central_widget.addWidget(self.groups)
        self.central_widget.addWidget(self.sequence_editor)

        # New experiment view is created with a new experiment ---------------------------------------------------------
        self.actionNew()

    # Get/Set methods ==================================================================================================
    def model(self) -&gt; Optional[Experiment]:
        &#34;&#34;&#34;Return the experiment, assosiated with this view.&#34;&#34;&#34;
        return self._model
    
    def projectTitle(self) -&gt; str:
        &#34;&#34;&#34;Return document title, i.e. name of file this experiment is saved as.
        If no file has been associated with this experiment, returns &#34;Untitled&#34;.
        &#34;&#34;&#34;
        if self.savePath():
            return Path(self.savePath()).stem
        return &#34;Untitled&#34;

    def savePath(self) -&gt; Optional[str]:
        &#34;&#34;&#34;Return path of the file from which the &#34;&#34;&#34;
        return self._save_path

    def setModel(self, ex: Experiment, /):
        self._model = ex

        self.tree.setExperiment(ex)
        self.signal_editor.setScheme(ex.signal_scheme)

        self.sequence_editor.setScheme(ex.sequence_scheme)

        ex.blocks.itemAdded.connect(self._onBlockAdded)
        ex.blocks.itemRenamed.connect(self._onBlockRenamed)
        ex.blocks.itemRemoved.connect(self._onBlockRemoved)
        ex.groups.itemAdded.connect(self._onGroupAdded)
        ex.groups.itemRenamed.connect(self._onGroupRenamed)
        ex.groups.itemRemoved.connect(self._onGroupRemoved)

        ex._view = self
        ex.updateView()

    # Experiment syncronization ========================================================================================
    def updateModel(self):
        &#34;&#34;&#34;Update the experiment when data in the view was changed by the user.&#34;&#34;&#34;
        ex = self.model()
        if ex is None:
            return
        
        # For each block, write it&#39;s data to the experiment
        for name in self.blocks.keys():
            block_view: BlockView = self.blocks.widget(name).widget()
            block_view.updateModel()
        
        # For each group, write its data to the experiment
        for name in self.groups.keys():
            group_view: GroupView = self.groups.widget(name).widget()
            group_view.updateModel()

        # Write general experiment data
        self.general_view.updateModel(ex)

    def _onBlockAdded(self, name):
        &#34;&#34;&#34;Function that gets called when a new block has been added to the experiment.&#34;&#34;&#34;
        # Add an item to the property tree
        tree_item = QStandardItem(name)
        tree_item.setFlags(Qt.ItemIsEnabled | Qt.ItemIsSelectable | Qt.ItemIsEditable)
        self.tree.blocks.appendRow(tree_item)
        
        # Add a view to the widget stack
        block_view = BlockView()
        block_view.setModel(self.model().blocks[name])
        scrollarea = QScrollArea()
        scrollarea.setWidget(block_view)
        self.blocks.addWidget(name, scrollarea)

        # Add a node to draw the sequence
        node = BlockNode()
        node.setTitle(name)
        self.sequence_editor.toolbox().addItem(name, node)

        # Select this item
        self.tree_view.setCurrentIndex(self.tree.indexFromItem(tree_item))
    
    def _onGroupAdded(self, name):
        &#34;&#34;&#34;Function that gets called when a new group has been added to the experiment.&#34;&#34;&#34;
        # Add an item to the property tree
        tree_item = QStandardItem(name)
        tree_item.setFlags(Qt.ItemIsEnabled | Qt.ItemIsSelectable | Qt.ItemIsEditable)
        self.tree.groups.appendRow(tree_item)

        # Add a view to the widget stack
        group_view = GroupView()
        group_view.setModel(self.model().groups[name])
        scrollarea = QScrollArea()
        scrollarea.setWidget(group_view)
        self.groups.addWidget(name, scrollarea)

        # Add a node to draw the sequence
        node = GroupNode()
        node.setTitle(name)
        self.sequence_editor.toolbox().addItem(name, node)

        # Select this item
        self.tree_view.setCurrentIndex(self.tree.indexFromItem(tree_item))
    
    def _onBlockRenamed(self, old_name, new_name):
        &#34;&#34;&#34;Function that gets called when a block has been renamed.&#34;&#34;&#34;
        # Rename it in the property tree
        for i in range(self.tree.blocks.rowCount()):
            item = self.tree.blocks.child(i)
            if item.text() == old_name:
                item.setText(new_name)
                break
        
        # Rename in widget stack
        current_key = self.blocks.currentKey()

        w = self.blocks.removeWidget(old_name)
        self.blocks.addWidget(new_name, w)

        if current_key == old_name:
            self.blocks.setCurrentKey(new_name)

        # Rename in the sequence editor
        node = self.sequence_editor.toolbox().removeItem(old_name)
        self.sequence_editor.toolbox().addItem(new_name, node)

        for node in self.sequence_editor.scheme().graph.nodes:
            if node.title() == old_name:
                node.setTitle(new_name)

    def _onGroupRenamed(self, old_name, new_name):
        &#34;&#34;&#34;Function that gets called when a group has been renamed.&#34;&#34;&#34;
        # Rename it in the property tree
        for i in range(self.tree.groups.rowCount()):
            item = self.tree.groups.child(i)
            if item.text() == old_name:
                item.setText(new_name)
                break
        
        # Rename in widget stack
        current_key = self.groups.currentKey()

        w = self.groups.removeWidget(old_name)
        self.groups.addWidget(new_name, w)

        if current_key == old_name:
            self.groups.setCurrentKey(new_name)

        # Rename in the sequence editor
        node = self.sequence_editor.toolbox().removeItem(old_name)
        self.sequence_editor.toolbox().addItem(new_name, node)

        for node in self.sequence_editor.scheme().graph.nodes:
            if node.title() == old_name:
                node.setTitle(new_name)

    def _onBlockRemoved(self, name):
        &#34;&#34;&#34;Function that gets called when a block has been removed from the experiment.&#34;&#34;&#34;
        # Find and remove it from the property tree
        for i in range(self.tree.blocks.rowCount()):
            item = self.tree.blocks.child(i)
            if item.text() == name:
                self.tree.blocks.removeRow(i)
                break
        
        # Remove from widget stack and the sequence editor toolbox
        self.blocks.removeWidget(name)
        self.sequence_editor.toolbox().removeItem(name)
    
    def _onGroupRemoved(self, name):
        &#34;&#34;&#34;Function that gets called when a block has been removed from the experiment.&#34;&#34;&#34;
        # Find and remove it from the property tree        
        for i in range(self.tree.groups.rowCount()):
            item = self.tree.groups.child(i)
            if item.text() == name:
                self.tree.groups.removeRow(i)
                break
        
        # Remove from widget stack and the sequence editor toolbox
        self.groups.removeWidget(name)
        self.sequence_editor.toolbox().removeItem(name)

    # Property tree syncronization =====================================================================================
    def displayTreeItem(self, index: QModelIndex):
        &#34;&#34;&#34;Display the widget corresponding to the item in the property tree.&#34;&#34;&#34;
        item = self.tree.itemFromIndex(index)

        if item is self.tree.general:
            # General
            scrollarea = self.general_view.parent().parent()
            assert type(scrollarea) == QScrollArea
            self.central_widget.setCurrentWidget(scrollarea)
        elif item is self.tree.signals:
            # Signal editor
            self.central_widget.setCurrentWidget(self.signal_editor)
        elif item.parent() is self.tree.blocks:
            # A block
            self.central_widget.setCurrentWidget(self.blocks)
            self.blocks.setCurrentKey(item.text())
        elif item.parent() is self.tree.groups:
            # A group
            self.central_widget.setCurrentWidget(self.groups)
            self.groups.setCurrentKey(item.text())
        elif item is self.tree.sequence:
            # Sequence editor
            self.central_widget.setCurrentWidget(self.sequence_editor)

    # User actions =====================================================================================================
    def actionNew(self) -&gt; bool:
        if self.model() and not self.promptSaveChanges():
            return False  # Action cancelled during prompt

        self.setModel(Experiment())
        self._save_path = None
        self.setWindowTitle(self.projectTitle() + &#34; - NFB Studio&#34;)
        return True

    def actionExport(self) -&gt; bool:        
        self.updateModel()
        
        if (len(self.model().sequence_scheme.graph.nodes) == 0):
            # No nodes in sequence scheme, cancel operation
            # TODO: A better way to signal to the user that he needs to create a sequence?
            self.central_widget.setCurrentWidget(self.sequence_editor)
            return

        wiz = ExportWizard(self, self.model())
        ok = wiz.exec_()
        
        if not ok:
            return  # User cancelled operation

        data = self.model().export(wiz.sequence())
        with open(wiz.savePath(), &#34;w&#34;) as file:
            file.write(data)
        return True

    def actionSave(self) -&gt; bool:
        &#34;&#34;&#34;User action &#34;Save&#34;. Saves file to its location, or promts user if no location exists yet.
        Returns True if file was saved, and False if action was cancelled.
        &#34;&#34;&#34;
        if self.savePath() is None:
            return self.actionSaveAs()
        
        self.fileSave(self.savePath())
        self.setWindowTitle(self.projectTitle() + &#34; - NFB Studio&#34;)
        return True

    def actionSaveAs(self) -&gt; bool:
        &#34;&#34;&#34;User action &#34;Save As&#34;. Promts user to save file as.
        Returns True if file was saved, and False if action was cancelled.
        &#34;&#34;&#34;
        path = QFileDialog.getSaveFileName(filter=&#34;Experiment Files (*.nfbex)&#34;)[0]
        if path == &#34;&#34;:
            return False  # Action was cancelled

        if os.path.splitext(path)[1] == &#34;&#34;:  # No extension
            path = path + &#34;.nfbex&#34;

        self._save_path = path
        self.fileSave(self.savePath())
        self.setWindowTitle(self.projectTitle() + &#34; - NFB Studio&#34;)
        return True

    def actionOpen(self) -&gt; bool:
        &#34;&#34;&#34;User action &#34;Open&#34;. Promts user to open a file.
        Returns True if file was opened, and False if action was cancelled.
        &#34;&#34;&#34;
        if self.model() and not self.promptSaveChanges():
            return False  # Action cancelled during prompt

        path = QFileDialog.getOpenFileName(filter=&#34;Experiment Files (*.nfbex)&#34;)[0]
        if path == &#34;&#34;:
            return False

        self.fileOpen(path)
        self.setWindowTitle(self.projectTitle() + &#34; - NFB Studio&#34;)
        return True

    def actionImport(self) -&gt; bool:
        &#34;&#34;&#34;User action &#34;Import&#34;. Promts user to import a file.
        Returns True if file was imported, and False if action was cancelled.
        &#34;&#34;&#34;
        if self.model() and not self.promptSaveChanges():
            return False  # Action cancelled during prompt

        file_path = QFileDialog.getOpenFileName(filter=&#34;XML Files (*.xml)&#34;)[0]
        if file_path == &#34;&#34;:
            return False

        with open(file_path) as file:
            data = file.read()
        
        ex = Experiment.import_xml(data)
        self.setModel(ex)
        return True

    def actionStartExperiment(self):
        self.updateModel()
        
        if (len(self.model().sequence_scheme.graph.nodes) == 0):
            # No nodes in sequence scheme, cancel operation
            # TODO: A better way to signal to the user that he needs to create a sequence?
            self.central_widget.setCurrentWidget(self.sequence_editor)
            return

        wiz = ExportWizard(self, self.model())
        ok = wiz.exec_()
        
        if not ok:
            return  # User cancelled operation

        data = self.model().export(wiz.sequence())
        with open(wiz.savePath(), &#34;w&#34;) as file:
            file.write(data)
        
        pynfb_path = os.path.dirname(nfb_studio.__file__) + &#34;/bin/pynfb.exe&#34;
        subprocess.run([pynfb_path, &#34;-x&#34;, wiz.savePath()])

    def promptSaveChanges(self) -&gt; bool:
        &#34;&#34;&#34;Prompt the user to save changes to current project.
        Display a message box asking the user if they want to save changes. If user selects Save, execute actionSave.
        Returns True if the user decided to discard changes or saved the file, and False if the user cancelled operation
        either during prompt or during save.
        &#34;&#34;&#34;
        prompt = QMessageBox()
        prompt.setWindowTitle(&#34;NFB Studio&#34;)
        prompt.setIcon(QMessageBox.Warning)
        prompt.setText(&#34;Save changes to \&#34;{}\&#34; before closing?&#34;.format(self.projectTitle()))
        prompt.setStandardButtons(QMessageBox.Save | QMessageBox.Discard | QMessageBox.Cancel)
        prompt.setDefaultButton(QMessageBox.Save)
        
        answer = prompt.exec_()
        if answer == QMessageBox.Cancel:
            return False
        if answer == QMessageBox.Save:
            return self.actionSave()
        return True

    def closeEvent(self, event):
        if self.model():
            event.setAccepted(self.promptSaveChanges())
        else:
            event.accept()

    # File operations ==================================================================================================
    def fileOpen(self, path):
        with open(path) as file:
            data = file.read()
        
        ex = Experiment.load(data)
        self.setModel(ex)
        self._save_path = path

    def fileSave(self, path):
        self.model().view().updateModel()
        data = self.model().save()

        with open(path, &#34;w&#34;) as file:
            file.write(data)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PySide2.QtWidgets.QMainWindow</li>
<li>PySide2.QtWidgets.QWidget</li>
<li>PySide2.QtCore.QObject</li>
<li>PySide2.QtGui.QPaintDevice</li>
<li>Shiboken.Object</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="nfb_studio.experiment_view.ExperimentView.staticMetaObject"><code class="name">var <span class="ident">staticMetaObject</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="nfb_studio.experiment_view.ExperimentView.actionExport"><code class="name flex">
<span>def <span class="ident">actionExport</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actionExport(self) -&gt; bool:        
    self.updateModel()
    
    if (len(self.model().sequence_scheme.graph.nodes) == 0):
        # No nodes in sequence scheme, cancel operation
        # TODO: A better way to signal to the user that he needs to create a sequence?
        self.central_widget.setCurrentWidget(self.sequence_editor)
        return

    wiz = ExportWizard(self, self.model())
    ok = wiz.exec_()
    
    if not ok:
        return  # User cancelled operation

    data = self.model().export(wiz.sequence())
    with open(wiz.savePath(), &#34;w&#34;) as file:
        file.write(data)
    return True</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.actionImport"><code class="name flex">
<span>def <span class="ident">actionImport</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>User action "Import". Promts user to import a file.
Returns True if file was imported, and False if action was cancelled.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actionImport(self) -&gt; bool:
    &#34;&#34;&#34;User action &#34;Import&#34;. Promts user to import a file.
    Returns True if file was imported, and False if action was cancelled.
    &#34;&#34;&#34;
    if self.model() and not self.promptSaveChanges():
        return False  # Action cancelled during prompt

    file_path = QFileDialog.getOpenFileName(filter=&#34;XML Files (*.xml)&#34;)[0]
    if file_path == &#34;&#34;:
        return False

    with open(file_path) as file:
        data = file.read()
    
    ex = Experiment.import_xml(data)
    self.setModel(ex)
    return True</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.actionNew"><code class="name flex">
<span>def <span class="ident">actionNew</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actionNew(self) -&gt; bool:
    if self.model() and not self.promptSaveChanges():
        return False  # Action cancelled during prompt

    self.setModel(Experiment())
    self._save_path = None
    self.setWindowTitle(self.projectTitle() + &#34; - NFB Studio&#34;)
    return True</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.actionOpen"><code class="name flex">
<span>def <span class="ident">actionOpen</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>User action "Open". Promts user to open a file.
Returns True if file was opened, and False if action was cancelled.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actionOpen(self) -&gt; bool:
    &#34;&#34;&#34;User action &#34;Open&#34;. Promts user to open a file.
    Returns True if file was opened, and False if action was cancelled.
    &#34;&#34;&#34;
    if self.model() and not self.promptSaveChanges():
        return False  # Action cancelled during prompt

    path = QFileDialog.getOpenFileName(filter=&#34;Experiment Files (*.nfbex)&#34;)[0]
    if path == &#34;&#34;:
        return False

    self.fileOpen(path)
    self.setWindowTitle(self.projectTitle() + &#34; - NFB Studio&#34;)
    return True</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.actionSave"><code class="name flex">
<span>def <span class="ident">actionSave</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>User action "Save". Saves file to its location, or promts user if no location exists yet.
Returns True if file was saved, and False if action was cancelled.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actionSave(self) -&gt; bool:
    &#34;&#34;&#34;User action &#34;Save&#34;. Saves file to its location, or promts user if no location exists yet.
    Returns True if file was saved, and False if action was cancelled.
    &#34;&#34;&#34;
    if self.savePath() is None:
        return self.actionSaveAs()
    
    self.fileSave(self.savePath())
    self.setWindowTitle(self.projectTitle() + &#34; - NFB Studio&#34;)
    return True</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.actionSaveAs"><code class="name flex">
<span>def <span class="ident">actionSaveAs</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>User action "Save As". Promts user to save file as.
Returns True if file was saved, and False if action was cancelled.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actionSaveAs(self) -&gt; bool:
    &#34;&#34;&#34;User action &#34;Save As&#34;. Promts user to save file as.
    Returns True if file was saved, and False if action was cancelled.
    &#34;&#34;&#34;
    path = QFileDialog.getSaveFileName(filter=&#34;Experiment Files (*.nfbex)&#34;)[0]
    if path == &#34;&#34;:
        return False  # Action was cancelled

    if os.path.splitext(path)[1] == &#34;&#34;:  # No extension
        path = path + &#34;.nfbex&#34;

    self._save_path = path
    self.fileSave(self.savePath())
    self.setWindowTitle(self.projectTitle() + &#34; - NFB Studio&#34;)
    return True</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.actionStartExperiment"><code class="name flex">
<span>def <span class="ident">actionStartExperiment</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actionStartExperiment(self):
    self.updateModel()
    
    if (len(self.model().sequence_scheme.graph.nodes) == 0):
        # No nodes in sequence scheme, cancel operation
        # TODO: A better way to signal to the user that he needs to create a sequence?
        self.central_widget.setCurrentWidget(self.sequence_editor)
        return

    wiz = ExportWizard(self, self.model())
    ok = wiz.exec_()
    
    if not ok:
        return  # User cancelled operation

    data = self.model().export(wiz.sequence())
    with open(wiz.savePath(), &#34;w&#34;) as file:
        file.write(data)
    
    pynfb_path = os.path.dirname(nfb_studio.__file__) + &#34;/bin/pynfb.exe&#34;
    subprocess.run([pynfb_path, &#34;-x&#34;, wiz.savePath()])</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.closeEvent"><code class="name flex">
<span>def <span class="ident">closeEvent</span></span>(<span>self, event)</span>
</code></dt>
<dd>
<div class="desc"><p>closeEvent(self, event: PySide2.QtGui.QCloseEvent)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def closeEvent(self, event):
    if self.model():
        event.setAccepted(self.promptSaveChanges())
    else:
        event.accept()</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.displayTreeItem"><code class="name flex">
<span>def <span class="ident">displayTreeItem</span></span>(<span>self, index: PySide2.QtCore.QModelIndex)</span>
</code></dt>
<dd>
<div class="desc"><p>Display the widget corresponding to the item in the property tree.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def displayTreeItem(self, index: QModelIndex):
    &#34;&#34;&#34;Display the widget corresponding to the item in the property tree.&#34;&#34;&#34;
    item = self.tree.itemFromIndex(index)

    if item is self.tree.general:
        # General
        scrollarea = self.general_view.parent().parent()
        assert type(scrollarea) == QScrollArea
        self.central_widget.setCurrentWidget(scrollarea)
    elif item is self.tree.signals:
        # Signal editor
        self.central_widget.setCurrentWidget(self.signal_editor)
    elif item.parent() is self.tree.blocks:
        # A block
        self.central_widget.setCurrentWidget(self.blocks)
        self.blocks.setCurrentKey(item.text())
    elif item.parent() is self.tree.groups:
        # A group
        self.central_widget.setCurrentWidget(self.groups)
        self.groups.setCurrentKey(item.text())
    elif item is self.tree.sequence:
        # Sequence editor
        self.central_widget.setCurrentWidget(self.sequence_editor)</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.fileOpen"><code class="name flex">
<span>def <span class="ident">fileOpen</span></span>(<span>self, path)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def fileOpen(self, path):
    with open(path) as file:
        data = file.read()
    
    ex = Experiment.load(data)
    self.setModel(ex)
    self._save_path = path</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.fileSave"><code class="name flex">
<span>def <span class="ident">fileSave</span></span>(<span>self, path)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def fileSave(self, path):
    self.model().view().updateModel()
    data = self.model().save()

    with open(path, &#34;w&#34;) as file:
        file.write(data)</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.model"><code class="name flex">
<span>def <span class="ident">model</span></span>(<span>self) ‑> typing.Union[<a title="nfb_studio.experiment.Experiment" href="experiment.html#nfb_studio.experiment.Experiment">Experiment</a>, NoneType]</span>
</code></dt>
<dd>
<div class="desc"><p>Return the experiment, assosiated with this view.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def model(self) -&gt; Optional[Experiment]:
    &#34;&#34;&#34;Return the experiment, assosiated with this view.&#34;&#34;&#34;
    return self._model</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.projectTitle"><code class="name flex">
<span>def <span class="ident">projectTitle</span></span>(<span>self) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Return document title, i.e. name of file this experiment is saved as.
If no file has been associated with this experiment, returns "Untitled".</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def projectTitle(self) -&gt; str:
    &#34;&#34;&#34;Return document title, i.e. name of file this experiment is saved as.
    If no file has been associated with this experiment, returns &#34;Untitled&#34;.
    &#34;&#34;&#34;
    if self.savePath():
        return Path(self.savePath()).stem
    return &#34;Untitled&#34;</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.promptSaveChanges"><code class="name flex">
<span>def <span class="ident">promptSaveChanges</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>Prompt the user to save changes to current project.
Display a message box asking the user if they want to save changes. If user selects Save, execute actionSave.
Returns True if the user decided to discard changes or saved the file, and False if the user cancelled operation
either during prompt or during save.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def promptSaveChanges(self) -&gt; bool:
    &#34;&#34;&#34;Prompt the user to save changes to current project.
    Display a message box asking the user if they want to save changes. If user selects Save, execute actionSave.
    Returns True if the user decided to discard changes or saved the file, and False if the user cancelled operation
    either during prompt or during save.
    &#34;&#34;&#34;
    prompt = QMessageBox()
    prompt.setWindowTitle(&#34;NFB Studio&#34;)
    prompt.setIcon(QMessageBox.Warning)
    prompt.setText(&#34;Save changes to \&#34;{}\&#34; before closing?&#34;.format(self.projectTitle()))
    prompt.setStandardButtons(QMessageBox.Save | QMessageBox.Discard | QMessageBox.Cancel)
    prompt.setDefaultButton(QMessageBox.Save)
    
    answer = prompt.exec_()
    if answer == QMessageBox.Cancel:
        return False
    if answer == QMessageBox.Save:
        return self.actionSave()
    return True</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.savePath"><code class="name flex">
<span>def <span class="ident">savePath</span></span>(<span>self) ‑> typing.Union[str, NoneType]</span>
</code></dt>
<dd>
<div class="desc"><p>Return path of the file from which the</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def savePath(self) -&gt; Optional[str]:
    &#34;&#34;&#34;Return path of the file from which the &#34;&#34;&#34;
    return self._save_path</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.setModel"><code class="name flex">
<span>def <span class="ident">setModel</span></span>(<span>self, ex: <a title="nfb_studio.experiment.Experiment" href="experiment.html#nfb_studio.experiment.Experiment">Experiment</a>, /)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setModel(self, ex: Experiment, /):
    self._model = ex

    self.tree.setExperiment(ex)
    self.signal_editor.setScheme(ex.signal_scheme)

    self.sequence_editor.setScheme(ex.sequence_scheme)

    ex.blocks.itemAdded.connect(self._onBlockAdded)
    ex.blocks.itemRenamed.connect(self._onBlockRenamed)
    ex.blocks.itemRemoved.connect(self._onBlockRemoved)
    ex.groups.itemAdded.connect(self._onGroupAdded)
    ex.groups.itemRenamed.connect(self._onGroupRenamed)
    ex.groups.itemRemoved.connect(self._onGroupRemoved)

    ex._view = self
    ex.updateView()</code></pre>
</details>
</dd>
<dt id="nfb_studio.experiment_view.ExperimentView.updateModel"><code class="name flex">
<span>def <span class="ident">updateModel</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Update the experiment when data in the view was changed by the user.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def updateModel(self):
    &#34;&#34;&#34;Update the experiment when data in the view was changed by the user.&#34;&#34;&#34;
    ex = self.model()
    if ex is None:
        return
    
    # For each block, write it&#39;s data to the experiment
    for name in self.blocks.keys():
        block_view: BlockView = self.blocks.widget(name).widget()
        block_view.updateModel()
    
    # For each group, write its data to the experiment
    for name in self.groups.keys():
        group_view: GroupView = self.groups.widget(name).widget()
        group_view.updateModel()

    # Write general experiment data
    self.general_view.updateModel(ex)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="nfb_studio" href="index.html">nfb_studio</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="nfb_studio.experiment_view.ExperimentView" href="#nfb_studio.experiment_view.ExperimentView">ExperimentView</a></code></h4>
<ul class="">
<li><code><a title="nfb_studio.experiment_view.ExperimentView.actionExport" href="#nfb_studio.experiment_view.ExperimentView.actionExport">actionExport</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.actionImport" href="#nfb_studio.experiment_view.ExperimentView.actionImport">actionImport</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.actionNew" href="#nfb_studio.experiment_view.ExperimentView.actionNew">actionNew</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.actionOpen" href="#nfb_studio.experiment_view.ExperimentView.actionOpen">actionOpen</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.actionSave" href="#nfb_studio.experiment_view.ExperimentView.actionSave">actionSave</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.actionSaveAs" href="#nfb_studio.experiment_view.ExperimentView.actionSaveAs">actionSaveAs</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.actionStartExperiment" href="#nfb_studio.experiment_view.ExperimentView.actionStartExperiment">actionStartExperiment</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.closeEvent" href="#nfb_studio.experiment_view.ExperimentView.closeEvent">closeEvent</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.displayTreeItem" href="#nfb_studio.experiment_view.ExperimentView.displayTreeItem">displayTreeItem</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.fileOpen" href="#nfb_studio.experiment_view.ExperimentView.fileOpen">fileOpen</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.fileSave" href="#nfb_studio.experiment_view.ExperimentView.fileSave">fileSave</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.model" href="#nfb_studio.experiment_view.ExperimentView.model">model</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.projectTitle" href="#nfb_studio.experiment_view.ExperimentView.projectTitle">projectTitle</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.promptSaveChanges" href="#nfb_studio.experiment_view.ExperimentView.promptSaveChanges">promptSaveChanges</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.savePath" href="#nfb_studio.experiment_view.ExperimentView.savePath">savePath</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.setModel" href="#nfb_studio.experiment_view.ExperimentView.setModel">setModel</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.staticMetaObject" href="#nfb_studio.experiment_view.ExperimentView.staticMetaObject">staticMetaObject</a></code></li>
<li><code><a title="nfb_studio.experiment_view.ExperimentView.updateModel" href="#nfb_studio.experiment_view.ExperimentView.updateModel">updateModel</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.8.4</a>.</p>
</footer>
</body>
</html>